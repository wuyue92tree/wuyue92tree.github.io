(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{483:function(e,t,r){"use strict";r.r(t);var s=r(12),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",[e._v("介绍")]),e._v(" "),r("p",[e._v("在k8s集群中，通过drone与bitbucket server集成实现软件开发的持续集成与构建。")]),e._v(" "),r("h1",[e._v("软件清单")]),e._v(" "),r("p",[e._v("drone (v1.0.0-rc.5)\nbitbucket server (v6.2.0)")]),e._v(" "),r("h1",[e._v("部署")]),e._v(" "),r("p",[e._v("通过helm进行部署 "),r("a",{attrs:{href:"https://github.com/helm/charts/tree/master/stable/drone"}},[e._v("https://github.com/helm/charts/tree/master/stable/drone")])]),e._v(" "),r("p",[e._v("drone环境变量参考 "),r("a",{attrs:{href:"https://docs.drone.io/installation/bitbucket-server/kubernetes/"}},[e._v("https://docs.drone.io/installation/bitbucket-server/kubernetes/")])]),e._v(" "),r("pre",[r("code",[e._v("# drone-bitbucket-values.yaml\n"),r("h1",{attrs:{id:"helm-install-stable-drone-f-drone-bitbucket-values-yaml-name-drone-bitbucket-namespace-drone-bitbucket-version-v2-0-0-rc-9"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#helm-install-stable-drone-f-drone-bitbucket-values-yaml-name-drone-bitbucket-namespace-drone-bitbucket-version-v2-0-0-rc-9"}},[e._v("#")]),e._v(" helm install stable/drone -f drone-bitbucket-values.yaml --name drone-bitbucket --namespace drone-bitbucket --version v2.0.0-rc.9")]),e._v("\n"),r("h1",{attrs:{id:"values-yaml"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#values-yaml"}},[e._v("#")]),e._v(" values.yaml")]),e._v("\n"),r("h1",{attrs:{id:"https-github-com-helm-charts-blob-master-stable-drone-values-yaml"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#https-github-com-helm-charts-blob-master-stable-drone-values-yaml"}},[e._v("#")]),e._v(" https://github.com/helm/charts/blob/master/stable/drone/values.yaml")]),e._v("\n"),r("p",[e._v("service:\ntype: NodePort")]),e._v("\n"),r("p",[e._v("ingress:\nenabled: true\nhosts:\n- drone-bitbucket.antio.top")]),e._v("\n"),r("h2",{attrs:{id:"drone-ingress-tls-configuration-secrets"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#drone-ingress-tls-configuration-secrets"}},[e._v("#")]),e._v(" Drone Ingress TLS configuration secrets")]),e._v("\n"),r("h2",{attrs:{id:"must-be-manually-created-in-the-namespace"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#must-be-manually-created-in-the-namespace"}},[e._v("#")]),e._v(" Must be manually created in the namespace")]),e._v("\n"),r("h2",{attrs:{id:""}},[r("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")]),e._v(" ")]),e._v("\n"),r("p",[e._v("tls:\n- secretName: drone-bitbucket-tls\nhosts:\n- drone-bitbucket.antio.top")]),e._v("\n"),r("p",[e._v("sourceControl:")]),e._v("\n"),r("h2",{attrs:{id:"your-source-control-provider-github-gitlab-gitea-gogs-bitbucketcloud-bitbucketserver"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#your-source-control-provider-github-gitlab-gitea-gogs-bitbucketcloud-bitbucketserver"}},[e._v("#")]),e._v(" your source control provider: github,gitlab,gitea,gogs,bitbucketCloud,bitbucketServer")]),e._v("\n"),r("p",[e._v('provider: "bitbucketServer"')]),e._v("\n"),r("h2",{attrs:{id:"secret-containing-your-source-control-provider-secrets-keys-provided-below"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#secret-containing-your-source-control-provider-secrets-keys-provided-below"}},[e._v("#")]),e._v(" secret containing your source control provider secrets, keys provided below.")]),e._v("\n"),r("h2",{attrs:{id:"if-left-blank-will-assume-a-secret-based-on-the-release-name-of-the-chart"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#if-left-blank-will-assume-a-secret-based-on-the-release-name-of-the-chart"}},[e._v("#")]),e._v(" if left blank will assume a secret based on the release name of the chart.")]),e._v("\n"),r("h1",{attrs:{id:"在k8s中创建名为drone-bitbucket-source-control的secret-key、value分别对应consumerkey-privatekey-passwordkey的值"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#在k8s中创建名为drone-bitbucket-source-control的secret-key、value分别对应consumerkey-privatekey-passwordkey的值"}},[e._v("#")]),e._v(" 在k8s中创建名为drone-bitbucket-source-control的secret，key、value分别对应consumerKey，privateKey，passwordKey的值")]),e._v("\n"),r("p",[e._v("secret: drone-bitbucket-source-control")]),e._v("\n"),r("h2",{attrs:{id:"fill-in-the-correct-values-for-your-chosen-source-control-provider"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#fill-in-the-correct-values-for-your-chosen-source-control-provider"}},[e._v("#")]),e._v(" Fill in the correct values for your chosen source control provider")]),e._v("\n"),r("h2",{attrs:{id:"any-key-in-this-list-with-the-suffix-key-will-be-fetched-from-the"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#any-key-in-this-list-with-the-suffix-key-will-be-fetched-from-the"}},[e._v("#")]),e._v(" Any key in this list with the suffix "),r("code",[e._v("Key")]),e._v(" will be fetched from the")]),e._v("\n"),r("h2",{attrs:{id:"secret-named-above-if-not-provided-the-secret-it-will-be-created-as"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#secret-named-above-if-not-provided-the-secret-it-will-be-created-as"}},[e._v("#")]),e._v(" secret named above, if not provided the secret it will be created as")]),e._v("\n"),r("h2",{attrs:{id:"lt-fullname-gt-source-control-using-for-the-key-clientsecretkey-and"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#lt-fullname-gt-source-control-using-for-the-key-clientsecretkey-and"}},[e._v("#")]),e._v(" "),r("code",[e._v("&lt;fullName&gt;-source-control")]),e._v(' using for the key "ClientSecretKey" and')]),e._v("\n"),r("h1",{attrs:{id:"clientsecretvalue-for-the-value-be-awere-to-not-leak-shis-file-with-your-password"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretvalue-for-the-value-be-awere-to-not-leak-shis-file-with-your-password"}},[e._v("#")]),e._v(' "clientSecretValue" for the value. Be awere to not leak shis file with your password')]),e._v("\n"),r("h1",{attrs:{id:"github"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#github"}},[e._v("#")]),e._v(" github:")]),e._v("\n"),r("h1",{attrs:{id:"clientid"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientid"}},[e._v("#")]),e._v(" clientID:")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretkey-clientsecret"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretkey-clientsecret"}},[e._v("#")]),e._v(" clientSecretKey: clientSecret")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretvalue"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretvalue"}},[e._v("#")]),e._v(" clientSecretValue:")]),e._v("\n"),r("h1",{attrs:{id:"server-https-github-com"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-https-github-com"}},[e._v("#")]),e._v(" server: https://github.com")]),e._v("\n"),r("h1",{attrs:{id:"gitlab"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#gitlab"}},[e._v("#")]),e._v(" gitlab:")]),e._v("\n"),r("h1",{attrs:{id:"clientid-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientid-2"}},[e._v("#")]),e._v(" clientID:")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretkey-clientsecret-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretkey-clientsecret-2"}},[e._v("#")]),e._v(" clientSecretKey: clientSecret")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretvalue-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretvalue-2"}},[e._v("#")]),e._v(" clientSecretValue:")]),e._v("\n"),r("h1",{attrs:{id:"server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[e._v("#")]),e._v(" server:")]),e._v("\n"),r("h1",{attrs:{id:"gitea"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#gitea"}},[e._v("#")]),e._v(" gitea:")]),e._v("\n"),r("h1",{attrs:{id:"server-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-2"}},[e._v("#")]),e._v(" server:")]),e._v("\n"),r("h1",{attrs:{id:"gogs"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#gogs"}},[e._v("#")]),e._v(" gogs:")]),e._v("\n"),r("h1",{attrs:{id:"server-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-3"}},[e._v("#")]),e._v(" server:")]),e._v("\n"),r("h1",{attrs:{id:"bitbucketcloud"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bitbucketcloud"}},[e._v("#")]),e._v(" bitbucketCloud:")]),e._v("\n"),r("h1",{attrs:{id:"clientid-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientid-3"}},[e._v("#")]),e._v(" clientID:")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretkey-clientsecret-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretkey-clientsecret-3"}},[e._v("#")]),e._v(" clientSecretKey: clientSecret")]),e._v("\n"),r("h1",{attrs:{id:"clientsecretvalue-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#clientsecretvalue-3"}},[e._v("#")]),e._v(" clientSecretValue:")]),e._v("\n"),r("p",[e._v('bitbucketServer:\nserver: "https://bitbucket.antio.top"\n# consumerKey配置为OauthKey，存于drone-bitbucket-source-control中\nconsumerKey: consumerKey\n# 一般为 /etc/bitbucket/key.pem，存于drone-bitbucket-source-control中\nprivateKey: privateKey\n# username更改为你的bitbucket用户名，字符串\nusername: "username"\n# username对应创建的bitbucket token，存于drone-bitbucket-source-control中\npasswordKey: passwordKey\nbitbucketCloud:\n# 此三项必须添加，chart模板中bitbucketServer的这三项配置被对应到了bitbucketCloud，应该会在后续版本中修复，当前chart版本v2.0.0-rc.9\nconsumerKey: consumerKey\nprivateKey: privateKey\npasswordKey: passwordKey\nserver:\nprotocol: https\nhost: "drone-bitbucket.antio.top"\nenv:\nDRONE_DEBUG: "false"\nDRONE_DATABASE_DRIVER: "sqlite3"\nDRONE_DATABASE_DATASOURCE: "/var/lib/drone/drone.sqlite"')]),e._v("\n"),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("## Drone requires some environment variables to bootstrap the\n## git service or it won&#039;t start up.\n## Uncomment this and add your own custom configuration.\nDRONE_SERVER_HOST: &quot;drone-bitbucket.antio.top&quot;\n")])])]),r("p",[e._v('persistence:\nenabled: true\nstorageClass: "nfs-client"')])])]),r("p")])}),[],!1,null,null,null);t.default=a.exports}}]);