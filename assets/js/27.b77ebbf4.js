(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{439:function(e,a,t){"use strict";t.r(a);var s=t(12),n=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",[e._v("什么是django？")]),e._v(" "),t("p",[e._v("Django is a high-level Python Web framework that encourages rapid development and clean, pragmatic design. Built by experienced developers, it takes care of much of the hassle of Web development, so you can focus on writing your app without needing to reinvent the wheel. It’s free and open source.")]),e._v(" "),t("p",[e._v("Django是一个高级Python Web框架，它鼓励快速的开发和简洁、实用的设计。它由经验丰富的开发人员开发而成，他们负责解决大部分Web开发中的麻烦，让你能专注与应用程序的编写，而不需要重新发明轮子。它是一个免费、开源的项目。")]),e._v(" "),t("h1",[e._v("运行环境")]),e._v(" "),t("p",[e._v("django只需要你安装有python环境就可以运行起来，而且它不依赖其他第三方模块，一个包就能完成网站开发。")]),e._v(" "),t("h1",[e._v("安装")]),e._v(" "),t("pre",[t("code",{staticClass:"language-shell"},[e._v("pip install django")])]),e._v(" "),t("h1",[e._v("Django中的MTV设计模式")]),e._v(" "),t("h2",[e._v("MVC设计模式")]),e._v(" "),t("p",[t("a",{attrs:{href:"http://baike.baidu.com/item/MVC"}},[e._v("MVC")]),e._v("全名是Model View Controller，是模型(Model)－视图(View)－控制器(Controller)的缩写。")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Model（模型）表示应用程序核心（通常模型对象负责在数据库中存取数据）。")])]),e._v(" "),t("li",[t("p",[e._v("View（视图）显示数据（通常视图是依据模型数据创建的）。")])]),e._v(" "),t("li",[t("p",[e._v("Controller（控制器）处理输入（通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据）。")])])]),e._v(" "),t("h2",[e._v("MTV设计模式")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("M 代表模型（Model）：负责业务对象和数据库的关系映射(ORM)。")])]),e._v(" "),t("li",[t("p",[e._v("T 代表模板 (Template)：负责如何把页面展示给用户(html)。")])]),e._v(" "),t("li",[t("p",[e._v("V 代表视图（View）：负责业务逻辑，并在适当时候调用Model和Template。")])])]),e._v(" "),t("p",[e._v("除了上述三层之外，django还提供了一个URL分发器，用于将一个个URL的请求分发到对应的View处理。")]),e._v(" "),t("h1",[e._v("django工作流程")]),e._v(" "),t("p",[t("img",{attrs:{src:"http://assets.tianmaying.com/md-image/0a7650b34227a541ffdf4c20e5c1c52a.png",alt:""}})]),e._v(" "),t("ol",[t("li",[t("p",[e._v("浏览器发起请求;")])]),e._v(" "),t("li",[t("p",[e._v("web server（nginx）对请求进行转发，静态文件直接访问/其他请求转发到wsgi服务器;")])]),e._v(" "),t("li",[t("p",[e._v("wsgi server接收请求，将请求转发给django，并由中间件进行预处理;")])]),e._v(" "),t("li",[t("p",[e._v("预处理完的请求，被转发到URL分发器，URL分发器将请求发送给对应的View进行处理;")])])]),e._v(" "),t("p",[e._v("5a. 若请求涉及到数据库操作，则通过models对数据库进行CRUD操作，并将结果通过templates渲染返回;")]),e._v(" "),t("p",[e._v("5b. 若请求不涉及数据库操作，则直接返回相应的templates页面;")]),e._v(" "),t("p",[e._v("5d. 若操作异常，则将异常返回。")]),e._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[t("p",[e._v("View将返回的页面返回给wsgi server，wsgi server将页面返回给web server;")])]),e._v(" "),t("li",[t("p",[e._v("web server将请求结果返回给浏览器。")])])]),e._v(" "),t("h1",[e._v("开始一个新的django项目")]),e._v(" "),t("h2",[e._v("初始化工程")]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v("django-admin startproject demo_project")])]),e._v(" "),t("h2",[e._v("初始化app")]),e._v(" "),t("pre",[t("code",[e._v("django-admin startapp demo_app")])]),e._v(" "),t("p",[e._v("工程目录如下所示：")]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v(".\n├── demo_app              # app目录\n│   ├── admin.py          # admin控制器，在使用django自带admin时使用\n│   ├── apps.py\n│   ├── __init__.py\n│   ├── migrations\n│   │   └── __init__.py\n│   ├── models.py         # 用于将数据库抽象化为orm对象\n│   ├── tests.py          # 单元测试\n│   └── views.py          # 用于请求逻辑的具体实现\n├── demo_project\n│   ├── __init__.py\n│   ├── settings.py       # 公共设置\n│   ├── urls.py           # 公共urls分发\n│   └── wsgi.py           # wsgi服务器接口\n└── manage.py             # 本地调试接口")])]),e._v(" "),t("h2",[e._v("配置")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://docs.djangoproject.com/en/1.11/topics/settings/"}},[e._v("settings")])]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v("# 常用配置\n"),t("h1",{attrs:{id:"是否启用debug模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#是否启用debug模式"}},[e._v("#")]),e._v(" 是否启用debug模式")]),e._v("\n"),t("p",[e._v("DEBUG = True")]),e._v("\n"),t("h1",{attrs:{id:"允许访问的hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#允许访问的hosts"}},[e._v("#")]),e._v(" 允许访问的hosts")]),e._v("\n"),t("p",[e._v("ALLOWED_HOSTS = []")]),e._v("\n"),t("h1",{attrs:{id:"加载的apps列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载的apps列表"}},[e._v("#")]),e._v(" 加载的APPS列表")]),e._v("\n"),t("p",[e._v("INSTALLED_APPS = []")]),e._v("\n"),t("h1",{attrs:{id:"中间件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中间件"}},[e._v("#")]),e._v(" 中间件")]),e._v("\n"),t("p",[e._v("MIDDLEWARE = []")]),e._v("\n"),t("h1",{attrs:{id:"url分发入口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url分发入口"}},[e._v("#")]),e._v(" URL分发入口")]),e._v("\n"),t("p",[e._v("ROOT_URLCONF = ''")]),e._v("\n"),t("h1",{attrs:{id:"指定templates路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定templates路径"}},[e._v("#")]),e._v(" 指定templates路径")]),e._v("\n"),t("p",[e._v("TEMPLATES = []")]),e._v("\n"),t("h1",{attrs:{id:"wsgi服务器入口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wsgi服务器入口"}},[e._v("#")]),e._v(" wsgi服务器入口")]),e._v("\n"),t("p",[e._v("WSGI_APPLICATION = ''")]),e._v("\n"),t("h1",{attrs:{id:"数据库配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库配置"}},[e._v("#")]),e._v(" 数据库配置")]),e._v("\n"),t("p",[e._v("DATABASES = {}")]),e._v("\n"),t("h1",{attrs:{id:"默认语言设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#默认语言设置"}},[e._v("#")]),e._v(" 默认语言设置")]),e._v("\n"),t("p",[e._v("LANGUAGE_CODE = 'en-us'")]),e._v("\n"),t("h1",{attrs:{id:"时区设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#时区设置"}},[e._v("#")]),e._v(" 时区设置")]),e._v("\n"),t("p",[e._v("TIME_ZONE = 'UTC'")]),e._v("\n"),t("h1",{attrs:{id:"静态文件前缀设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#静态文件前缀设置"}},[e._v("#")]),e._v(" 静态文件前缀设置")]),e._v("\n"),t("p",[e._v("STATIC_URL = '/static/'")])])]),e._v(" "),t("h2",[e._v("初始化数据库/配置admin账户")]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v("# 初始化数据库\npython manage.py makemigrations\npython manage.py migrate"),t("p"),e._v("\n"),t("h1",{attrs:{id:"创建admin帐号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建admin帐号"}},[e._v("#")]),e._v(" 创建admin帐号")]),e._v("\n"),t("p",[e._v("python manage.py createsuperuser")]),e._v("\n"),t("p",[e._v("Username (leave blank to use 'wuyue'): admin\nEmail address: admin@qq.com\nPassword:\nPassword (again):\nSuperuser created successfully.")])])]),e._v(" "),t("h2",[e._v("运行django，"),t("a",{attrs:{href:"http://127.0.0.1:8000"}},[e._v("http://127.0.0.1:8000")])]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v("# 默认url http://127.0.0.1:8000\npython manage.py runserver")])]),e._v(" "),t("h1",[e._v("admin后台")]),e._v(" "),t("h2",[e._v("认证模块介绍")]),e._v(" "),t("ol",[t("li",[e._v("用户")])]),e._v(" "),t("p",[e._v("username : 用户名")]),e._v(" "),t("p",[e._v("password : 密码")]),e._v(" "),t("p",[e._v("first_name : 名字")]),e._v(" "),t("p",[e._v("last_name : 姓氏")]),e._v(" "),t("p",[e._v("email : 电子邮箱")]),e._v(" "),t("p",[e._v("is_superuser : 标识是否为超级用户")]),e._v(" "),t("p",[e._v("is_staff : 标识是否能登录本后台")]),e._v(" "),t("p",[e._v("is_active : 标识账户活跃状态")]),e._v(" "),t("p",[e._v("permission : 用户权限")]),e._v(" "),t("p",[e._v("group : 用户所属用户组")]),e._v(" "),t("p",[e._v("last_login : 最后一次登录")]),e._v(" "),t("p",[e._v("date_joined : 加入时间")]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[e._v("组")])]),e._v(" "),t("p",[e._v("name : 组名称")]),e._v(" "),t("p",[e._v("permission : 权限")]),e._v(" "),t("h2",[e._v("models设置")]),e._v(" "),t("p",[e._v("以简单的个人博客后台为例：")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("总共三个表，文章/分类/标签;")])]),e._v(" "),t("li",[t("p",[e._v("表关系：文章和分类（一对多），文章和标签（多对多）。")])])]),e._v(" "),t("pre",[t("code",{staticClass:"language-python"},[e._v("# -"),t("em",[e._v("- coding: utf-8 -")]),e._v("-\nfrom "),t("strong",[e._v("future")]),e._v(" import unicode_literals"),t("p"),e._v("\n"),t("p",[e._v("from django.db import models")]),e._v("\n"),t("h1",{attrs:{id:"create-your-models-here"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-your-models-here"}},[e._v("#")]),e._v(" Create your models here.")]),e._v("\n"),t("p",[e._v('class Article(models.Model):\ntitle = models.CharField(max_length=255, verbose_name="标题")\ncontent = models.TextField(verbose_name="内容")\ncategory = models.ForeignKey(\'Category\', verbose_name="分类")\ntag = models.ManyToManyField(\'tag\', verbose_name="标签")\nis_published = models.BooleanField(default=False, verbose_name="发布状态")\nupdate_time = models.DateTimeField(verbose_name="更新时间")\ndateline = models.DateTimeField(auto_now=True, verbose_name="创建时间")')]),e._v("\n"),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("def __unicode__(self):\n    return &quot;%s&quot; % self.title\n\nclass Meta:\n    verbose_name = &quot;文章&quot;\n    verbose_name_plural = verbose_name\n")])])]),t("p",[e._v('class Category(models.Model):\ncategory = models.CharField(max_length=255, verbose_name="分类")\ndesc = models.TextField(verbose_name="描述")')]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("def __unicode__(self):\n    return &quot;%s&quot; % self.category\n\nclass Meta:\n    verbose_name = &quot;分类&quot;\n    verbose_name_plural = verbose_name\n")])])]),t("p",[e._v('class Tag(models.Model):\ntag = models.CharField(max_length=255, verbose_name="标签")')]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("def __unicode__(self):\n    return &quot;%s&quot; % self.tag\n\nclass Meta:\n    verbose_name = &quot;标签&quot;\n    verbose_name_plural = verbose_name</code></pre>\n")])])]),t("h2",[e._v("admin设置")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("将model注册到admin后台;")])]),e._v(" "),t("li",[t("p",[e._v("控制model展示到admin的字段及形式。")])])]),e._v(" "),t("pre",[t("code",{staticClass:"language-python"},[e._v("# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n"),t("p",[e._v("from django.contrib import admin\nfrom .models import Article, Category, Tag")]),e._v("\n"),t("h1",{attrs:{id:"register-your-models-here"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#register-your-models-here"}},[e._v("#")]),e._v(" Register your models here.")]),e._v("\n"),t("p",[e._v("@admin.register(Article)\nclass ArticleAdmin(admin.ModelAdmin):\nlist_display = ('title', 'category', 'is_published', 'update_time',\n'dateline')\nlist_filter = ('category__category',)\nsearch_fields = ('title',)\nactions = ['make_published']")]),e._v("\n"),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("def make_published(self, request, queryset):\n    queryset.update(is_published=1)\n\nmake_published.short_description = &quot;发布所选的 文章&quot;\n")])])]),t("p",[e._v("@admin.register(Category)\nclass CategoryAdmin(admin.ModelAdmin):\nlist_display = ('category', 'desc')")]),e._v(" "),t("p",[e._v("@admin.register(Tag)\nclass TagAdmin(admin.ModelAdmin):\npass")])])]),e._v(" "),t("h1",[e._v("django连接多个数据库")]),e._v(" "),t("h2",[e._v("添加数据库连接配置")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("选择合适的engine，django支持的数据库（sqlite3, mysql, postgreSQL, oracle）;")])]),e._v(" "),t("li",[t("p",[e._v("设置数据库连接的相关参数。")])])]),e._v(" "),t("pre",[t("code",{staticClass:"language-python"},[e._v("DATABASES = {\n'default': {\n'ENGINE': 'django.db.backends.sqlite3',\n'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),\n},\nxxx: {\n'ENGINE': 'django.db.backends.mysql',\n'NAME': xxx,\n'USER': xxx,\n'PASSWORD': xxx,\n'HOST': xxx,\n'PORT': '3306',\n},\n}")])]),e._v(" "),t("h2",[e._v("新增一个app，并添加到INSTALLED_APPS中")]),e._v(" "),t("h2",[e._v("添加路由组件及数据库app对应的MAPPING")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("添加路由组件;")])]),e._v(" "),t("li",[t("p",[e._v("添加MAPPING。")])])]),e._v(" "),t("pre",[t("code",{staticClass:"language-python"},[e._v("# 路由组件 path=工程目录/database_router.py"),t("p"),e._v("\n"),t("p",[e._v("#!/usr/bin/env python")]),e._v("\n"),t("h1",{attrs:{id:"coding-utf-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#coding-utf-8"}},[e._v("#")]),e._v(" -"),t("em",[e._v("- coding: utf-8 -")]),e._v("-")]),e._v("\n"),t("p",[e._v("from django.conf import settings")]),e._v("\n"),t("p",[e._v("DATABASE_MAPPING = settings.DATABASE_APPS_MAPPING")]),e._v("\n"),t("p",[e._v('class DatabaseAppsRouter(object):\n"""\nA router to control all database operations on models for different\ndatabases.')]),e._v("\n"),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("In case an app is not set in settings.DATABASE_APPS_MAPPING, the router\nwill fallback to the `default` database.\n\nSettings example:\n\nDATABASE_APPS_MAPPING = {&#039;app1&#039;: &#039;db1&#039;, &#039;app2&#039;: &#039;db2&#039;}\n&quot;&quot;&quot;\n\ndef db_for_read(self, model, **hints):\n    &quot;&quot;&quot;&quot;Point all read operations to the specific database.&quot;&quot;&quot;\n    if model._meta.app_label in DATABASE_MAPPING:\n        return DATABASE_MAPPING[model._meta.app_label]\n    return None\n\ndef db_for_write(self, model, **hints):\n    &quot;&quot;&quot;Point all write operations to the specific database.&quot;&quot;&quot;\n    if model._meta.app_label in DATABASE_MAPPING:\n        return DATABASE_MAPPING[model._meta.app_label]\n    return None\n\ndef allow_relation(self, obj1, obj2, **hints):\n    &quot;&quot;&quot;Allow any relation between apps that use the same database.&quot;&quot;&quot;\n    db_obj1 = DATABASE_MAPPING.get(obj1._meta.app_label)\n    db_obj2 = DATABASE_MAPPING.get(obj2._meta.app_label)\n    if db_obj1 and db_obj2:\n        if db_obj1 == db_obj2:\n            return True\n        else:\n            return False\n    return None\n\ndef allow_syncdb(self, db, model):\n    &quot;&quot;&quot;Make sure that apps only appear in the related database.&quot;&quot;&quot;\n\n    if db in DATABASE_MAPPING.values():\n        return DATABASE_MAPPING.get(model._meta.app_label) == db\n    elif model._meta.app_label in DATABASE_MAPPING:\n        return False\n    return None\n")])])]),t("h1",{attrs:{id:"数据库app的mapping"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库app的mapping"}},[e._v("#")]),e._v(" 数据库app的MAPPING")]),e._v(" "),t("p",[e._v("DATABASE_ROUTERS = ['database_router.DatabaseAppsRouter']\nDATABASE_APPS_MAPPING = {\n# example:\n# 'app_name':'database_name',\n'default': 'default',\nxxx: xxx,\n}")])])]),e._v(" "),t("h2",[e._v("抽象化表结构，生成models")]),e._v(" "),t("pre",[t("code",{staticClass:"language-bash"},[e._v("python manage.py inspectdb --database=database table")])]),e._v(" "),t("h1",[e._v("django常用的第三方扩展")]),e._v(" "),t("h2",[t("a",{attrs:{href:"http://djangosuit.com/"}},[e._v("django-suit ​")])]),e._v(" "),t("p",[e._v("基于bootstrap的后台管理主题，并集成了一些扩展功能，使admin的使用更灵活。")]),e._v(" "),t("h2",[t("a",{attrs:{href:"http://docs.celeryproject.org/en/latest/django/"}},[e._v("djcelery")])]),e._v(" "),t("p",[e._v("许多Django应用需要执行异步任务, 以便不耽误http request的执行. 我们也可以选择许多方法来完成异步任务, 使用Celery是一个比较好的选择, 因为Celery有着大量的社区支持, 能够完美的扩展, 和Django结合的也很好. 并且djcelery允许我们通过界面管理任务，使任务定时执行。")]),e._v(" "),t("h2",[t("a",{attrs:{href:"http://www.django-rest-framework.org/"}},[e._v("django-rest-framework")])]),e._v(" "),t("p",[e._v("Django REST framework 是一个强大且灵活的工具包，用以构建Web APIs。")]),e._v(" "),t("p",[e._v("为什么要使用REST framework？ ")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"http://restframework.herokuapp.com/"}},[e._v("在线可视的API")]),e._v("，对于赢得你的开发者们十分有用")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/authentication/"}},[e._v("验证策略")]),e._v("涵盖了"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/authentication/#django-rest-framework-oauth"}},[e._v("OAuth1a")]),e._v("和"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/authentication/#django-oauth-toolkit"}},[e._v("OAuth2")])])]),e._v(" "),t("li",[t("p",[e._v("同时支持"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/serializers#modelserializer"}},[e._v("ORM")]),e._v("和"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/serializers#serializers"}},[e._v("非ORM")]),e._v("数据源的"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/serializers/"}},[e._v("序列化")])])]),e._v(" "),t("li",[t("p",[e._v("可以配置各个环节，若无需"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/generic-views/"}},[e._v("更多")]),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/viewsets/"}},[e._v("强大")]),e._v("的"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/routers/"}},[e._v("特性")]),e._v("，使用"),t("a",{attrs:{href:"http://www.django-rest-framework.org/api-guide/views#function-based-views"}},[e._v("一般基于类（function-based）的视图（views）")]),e._v("即可")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.django-rest-framework.org/"}},[e._v("大量的文档")]),e._v("，强力的"),t("a",{attrs:{href:"https://groups.google.com/forum/?fromgroups#!forum/django-rest-framework"}},[e._v("社区支持")])])])]),e._v(" "),t("h2",[t("a",{attrs:{href:"http://django-haystack.readthedocs.io/en/master/"}},[e._v("haystack")])]),e._v(" "),t("p",[e._v("haystack是一个第三发Django的搜索模块。它的特点是一个统一的、熟悉的API允许你使用不同的搜索后端（如Solr，Elasticsearch，Whoosh，Xapian，等）而不需要修改你的代码。")]),t("p")])])])}),[],!1,null,null,null);a.default=n.exports}}]);