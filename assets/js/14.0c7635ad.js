(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{466:function(s,a,e){"use strict";e.r(a);var n=e(12),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),e("p",[s._v("在django的admin中，我们会碰到这样的情况，表B的a字段是表A的外键，表C的b字段是表B外键，而我们需要在表C中通过表A的字段进行过滤，然而在django中没法直接支持，这时候就需要自定义Filter来实现了。")]),s._v(" "),e("h3",{attrs:{id:"示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),e("h3",{attrs:{id:"models-py"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#models-py"}},[s._v("#")]),s._v(" models.py")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("from django.db import models\nclass A(models.Models):\n\tname = models.CharField(max_length=255, verbose_name='姓名')\nclass B(models.Models):\n\ta = models.ForeignKey('A', verbose_name='a', on_delete=models.CASCADE)\nclass C(models.Models):\n\tb = models.ForeignKey('B', verbose_name='b', on_delete=models.CASCADE)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"admin-py"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#admin-py"}},[s._v("#")]),s._v(" admin.py")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("from django.contrib import admin\nfrom .models import A, B, C\n\n# 错误的示范\n@admin.register(C)\nclass CAdmin(admin.ModelAdmin):\n\tlist_filter = ('b__a__name',)\n\n# 正确的示范\nfrom django.contrib.admin import SimpleListFilter\n\nclass NameFilter(SimpleListFilter):\n    title = '姓名'\n    parameter_name = 'a_name'\n\n    def lookups(self, request, model_admin):\n        names = C.objects.all().annotate(b__a__name=models.Count('b'))\n        choices = set([(b.a.id, b.a.name) for name in names])\n\n        return choices\n\n    def queryset(self, request, queryset):\n        if self.value():\n            return queryset.filter(b__a__id=self.value())\n        return queryset\n\n@admin.register(C)\nclass CAdmin(admin.ModelAdmin):\n\tlist_filter = (NameFilter,)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),e("p",[s._v("通过自定义Filter，根据表C对表A关联的字段进行过滤选项的构造，将queryset结果根据构造的过滤选项再次进行过滤。")])])}),[],!1,null,null,null);a.default=t.exports}}]);